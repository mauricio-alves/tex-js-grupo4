<template>
  <header id="topo" class="topo">
        <div class="topo__logo">
            <img src="@/assets/images/beach-svgrepo-com.svg" />
        </div>
        <div class="topo__logo-name">
            <h1>Atlantic Hotel</h1>
        </div>
        <div class="topo__menu-hb">
            <img src="@/assets/images/hamburger-menu-24.png" alt="menu hamburguer" />
        </div>
    </header>

    <!-- <nav class="nav_menu">
        <ul>
            <li><a href="/public">Home</a></li>
            <li><a href="/public/sobre.html">O hotel</a></li>
            <li><a href="/public/quartos.html">Quartos</a></li>
            <li><a href="/public/reservas.html">Reservas</a></li>
            <li><a href="/public/contato.html">Contato</a></li>
            <li><a href="/public/login.html">Login</a></li>
        </ul>
    </nav> -->

    <Menu />

    <main>
        <section class="container">
            <article>
                <h2>Minha Reserva</h2>
                <p>Forneça a data de entrada, saída e quantidade de pessoas:</p>
                <form class="container__form">
                    <div>
                        <label for="checkin">Check-in:</label>
                        <input v-model="reservation.checkin" id="checkin" type="date" />
                    </div>
                    <div>
                        <label for="checkout">Check-out:</label>
                        <input v-model="reservation.checkout" @change="checkDate" id="checkout" type="date" />
                    </div>
                    <div>
                        <label for="qtd_adultos">Número de hóspedes:</label>
                        <input v-model="reservation.qty" id="qtd_adultos" type="number" min="1" max="4" placeholder="limite de 4 pessoas" />
                    </div>
                </form>
            </article>
            
            <!-- <article class="cards">
                <div>
                    <h3>Escolha o quarto:</h3>
                    <span class="cards__detalhe"></span>
                </div>
                <div class="cards__images" id="cards"></div>
            </article> -->

            <CreateAccommodations />

            <Booking />

        </section>
    </main>

    <footer>
        <div>
            <div class="rodape">
                <div class="rodape__links">
                    <div class="rodape__links__navegacao">
                        <h3>Navegação</h3>
                        <ul>
                            <li><a href="/public/index.html">Home</a></li>
                            <li><a href="/public/sobre.html">O hotel</a></li>
                            <li><a href="/public/quartos.html">Quartos</a></li>
                            <li><a href="/public/reservas.html">Reservas</a></li>
                            <li><a href="/public/contato.html">Contato</a></li>
                            <li><a href="/public/login.html">Login</a></li>
                        </ul>
                    </div>
                    <div class="rodape__links__sobre-nos">
                        <h3>Sobre nós</h3>
                        <!-- <ul> -->
                            <li><a href="#">Fale com a gente</a></li>
                            <li><a href="#">Onde estamos</a></li>
                            <li><a href="#">Trabalhe conosco</a></li>
                            <li>
                                <p>Siga-nos:</p>
                            </li>
                            <li id="redes-sociais">
                                <a href="#"><img src="@/assets/images/facebook.png" alt="facebook logo" /></a>
                                <a href="#"> <img src="@/assets/images/instagram.png" alt="instagram logo" /></a>
                                <a href="#"> <img src="@/assets/images/whatsapp.png" alt="whatsapp logo" /></a>
                            </li>
                    </div>
                    <div class="rodape__links__termos">
                        <h3>Termos e Condições</h3>
                        <ul>
                            <li><a href="#">Termos de Uso</a></li>
                            <li><a href="#">Política de privacidade</a></li>
                        </ul>
                    </div>
                </div>
                <div class="rodape__seta">
                    <div class="rodape__seta__top-btn">
                        <a href="#topo">
                            <img src="@/assets/images/up-arrow-png-27160.png" alt="seta pra cima">
                        </a>
                    </div>
                    <div class="rodape__seta__idioma">
                        <label for="idioma">Idioma:</label>
                        <select name="idioma" id="idioma">
                            <option value="portugues">Português</option>
                            <option value="ingles">Inglês</option>
                            <option value="espanhol">Espanhol</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</template>

<script>
  import Menu from '@/components/Menu.vue';
  import CreateAccommodations from '@/components/CreateAccommodations.vue';
  import Booking from '@/components/Booking.vue';
  import { init, overview } from '@/store/reservations';
  import dbAccommodations from '@/store/db/dbAccommodations';
  import { sliceDate } from '@/store/functions/getDate';
//   import { watch, toRefs } from 'vue';
//   import store from '@/store';
//   import dbAccommodations from '@/store/db/dbAccommodations';

//   const calc = () => {
//     store.state.reservation.total = store.state.reservation.qty * dbAccommodations[store.state.reservation.id].price;
//   };

//   watch(() => {
    // const reservation = store.state.reservation.qty;
    // console.log(store.state.reservation.qty);
    // calc();
    // toRefs(reservation);
    // console.log(reservation.id);


    // const checkin = document.getElementById('checkin').value;

    // if (store.state.reservation.checkout <= store.state.reservation.checkin) {
    //   item.value = `${sliceDate(checkin).year}-${sliceDate(checkin).month}-${parseInt(sliceDate(checkin).day) + 1}`;
    //   alert('Atenção! A data de Check out não pode ser menor ou igual à data de Check in.');
    // };

    
    // store.state.reservation.total = reservation * dbAccommodations[0].price;
//   });

  export default {
    name: 'ReservationsView',

    components: {
      Menu,
      CreateAccommodations,
      Booking
    },

    computed: {
      reservation() {
        return this.$store.state.reservation;
      }
    },

    watch: {
      reservation: {
        handler() {
          // previous checkin
          const checkin = this.reservation.checkin;

          if (this.reservation.checkout <= this.reservation.checkin) {
            this.reservation.checkout = `${sliceDate(checkin).year}-${sliceDate(checkin).month}-${parseInt(sliceDate(checkin).day) + 1}`;
            alert('Atenção! A data de Check out não pode ser menor ou igual à data de Check in.');
          };

          let sumServices = 0;
          this.reservation.services.map(service => sumServices += service.price)
          this.reservation.rates = (new Date(this.reservation.checkout) - new Date(this.reservation.checkin)) / 86400000;    
          this.reservation.total = sumServices + (this.reservation.rates * this.reservation.qty * dbAccommodations[this.reservation.id].price);
        },
        deep: true
      } 
    },

//   methods: {
//     calc() {

//     }
//   },

    mounted() {
      init();
    //   overview();
      // this.reservation.qty = 2;
    }
  };
</script>

<style>
  @import '@/assets/css/reservas.css';
</style>
